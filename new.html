<script>

$(document).ready(function () {   
    
    app.home();//Get device list json
    

    $( "body" ).undelegate( ".btn-choose-device","click").delegate( ".btn-choose-device", "click", function() {
        let url = $(this).data("url"); //Load device.html
        device_id = $(this).data("device-id");
        device_code = $(this).data("device-code");

        $("#api_url").val(api_host+""+$(this).data("api-url")); //Add api url to input for later used!
        // console.log(api_url);

        (async function () {  
            $.blockUI();   
            var response = await axios.get(url);
            // console.log(response);

            app.saveProjectEditorJson(device_id,device_code);
            $( "#div_main" ).html(response.data);
            setTimeout(function(){
                app.loadAllFile(fileLocation); 
                $.unblockUI();
            }, 3000);               
          
        })()


        // $.get("url", function (data) {

        //     app.saveProjectEditorJson(device_id,device_code)
        //     // console.log(data["device"]);
        //     $( "#div_main" ).html(data);

            // setTimeout(function(){
            //         app.loadAllFile(fileLocation); 
            //         $.unblockUI();
            // }, 3000);            
        
        // });    
    })


    $('.hasTooltip').tooltip({"html": true,"container": "body"});

}); //End document ready


</script>

</head>
<body>


  
  
<h3 class="header smaller red">CHOOSE YOUR DEVICE TO CONTINUE...</h3>


<table style="width: 100%" class="table table-bordered table-striped tbl-devices">
    <thead>
    <tr>
    <th style="width:5px">#</th>
    <th style="width:10%">Device name</th>
    <th style="width:10%">Device code</th>
    <th ">Image</th>
    <th>Description</th>
    </tr>
    </thead>
    
    <tbody>


    </tbody>
</table>




  </body>
</html>

  <!-------- TEMPLATE DE RENDER DU LIEU TU JSON CUA DATATABLE ----------------->

<script type="text/template" class="template" id="tpl-datatable">
  <% 
  var tr_count = 0;  
  _.each(rows, function(row){
    tr_count++;
  %>
  <%= row.id %>
  <tr>
      <td><%= tr_count %></td>
      <td>
        <b><a href="#id" data-device-id="<%= row.id %>" data-device-code="<%= row.code %>"  class="btn-choose-device" data-api-url = "/iots/index.php?option=com_omg&view=omg&task=device&format=raw&id=<%= row.id %>" data-url="./device.html"><%= row.name %></a></b>
      </td>
      <td><%= row.code %></td>
      <td><img style="width:85%;margin-bottom:10px;border-radius:8px;max-width:50px;border: 1px solid #ddd;" src="./img/<%=row.image %>" ></td>
      <td><%= row.description %></td>
  </tr> 
 
  <% })  
  
  %>
  
  </script>	